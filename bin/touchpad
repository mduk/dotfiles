#!/bin/bash

if [[ $# -lt 1 ]]
then
  echo "Usage: touchpad <command>" >&2
  echo "       touchpad configure" >&2
  echo "       touchpad id       " >&2
  echo "       touchpad enable   " >&2
  echo "       touchpad disable  " >&2
  exit 1
fi

declare -A touchpad_config=(
  [libinput Tapping Enabled]=1
  [libinput Natural Scrolling Enabled]=1
  [libinput Accel Speed]=2.000000
  [libinput Disable While Typing Enabled]=1
  [libinput Click Method Enable]='0 1'
)

declare touchpad_id=$(
  xinput | sed \
    -e '/Touchpad/!d' \
    -e 's/.*id=\([0-9]*\).*/\1/'
)

notify() {
  notify-send \
    --icon=input-touchpad \
    "Touchpad $1"
}

touchpad-on() {
  xinput --list-props $touchpad_id | grep "Device Enabled.*:.*1$" >/dev/null
}

cmd-configure() {
  set -x
  for k in "${!touchpad_config[@]}"
  do
    declare v="${touchpad_config[$k]}"
    xinput set-prop "$touchpad_id" "$k" "$v"
  done
}

cmd-id() {
  echo $touchpad_id
}

cmd-on() {
  xinput enable $touchpad_id
  notify "On"
}

cmd-off() {
  xinput disable $touchpad_id
  notify "Off"
}

cmd-xprops() {
  xinput --list-props $touchpad_id
}

cmd-toggle() {
  if touchpad-on
  then cmd-off
  else cmd-on
  fi
}

declare cmdfunction="cmd-$1"

if declare -fp "$cmdfunction" &>/dev/null
then eval "$cmdfunction"
else
  echo "Invalid subcommand: $1" >&2
  exit 2
fi
